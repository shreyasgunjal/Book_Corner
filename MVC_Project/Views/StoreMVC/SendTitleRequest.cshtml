@model MVC_Project.Models.StoreRequest

@{
    ViewBag.Title = "Send Title Request";
}

<h2>Send Title Request</h2>

@using (Html.BeginForm("SendTitleRequest", "StoreMVC", FormMethod.Post, new { id = "requestForm" }))
{
    @Html.AntiForgeryToken()

    <div class="form-group">
        @Html.LabelFor(m => m.StoreId)
        @Html.TextBoxFor(m => m.StoreId, new { @class = "form-control" } )
        @Html.ValidationMessageFor(m => m.StoreId)
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.PublisherId)
        @Html.TextBoxFor(m => m.PublisherId, new { @class = "form-control" })
        @Html.ValidationMessageFor(m => m.PublisherId)
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.TitleId)
        @Html.TextBoxFor(m => m.TitleId, new { @class = "form-control" })
        @Html.ValidationMessageFor(m => m.TitleId)
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.RequestDetails)
        @Html.TextAreaFor(m => m.RequestDetails, new { @class = "form-control" })
        @Html.ValidationMessageFor(m => m.RequestDetails)
    </div>

    <div class="form-group">
        <button type="submit" class="btn btn-primary" id="submitRequestButton">Send Request</button>
    </div>
}




@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        

                var formData = {
                    StoreId: $('input[name="StoreId"]').val(),
                    PublisherId: $('input[name="PublisherId"]').val(),
                    TitleId: $('input[name="TitleId"]').val(),
                    RequestDetails: $('textarea[name="RequestDetails"]').val()
                };

                $.ajax({
                    url: 'https://localhost:44386/api/StoreRequests', // Correct API URL
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function (response) {
                        alert('Request sent successfully!');
                        // Optionally, redirect or update the UI
                    },
                    error: function (xhr, status, error) {
                        console.error('Error details:', {
                            status: status,
                            error: error,
                            responseText: xhr.responseText
                        });
                        alert('Server error: ' + xhr.responseText);
                    }
                });
            });
        });
        $(document).ready(function () {
            $('#requestForm').submit(function (event) {
                event.preventDefault(); // Prevent default form submission
    </script>

   


}
